{% extends "buylist/base.html" %}

{% block settings %}
    <div class="settings">
        <div class="search_bar">
            <input id="search_here" value="10" placeholder="type here to search.." />
        </div>
        <div class="bl_mode">
            <input type="checkbox" name="my-checkbox" id="bl_mode" />
            <label for="bl_mode">BL Mode</label>
        </div>
        <div class="zero_price">
            <input type="checkbox" name="my-checkbox" id="zero_price" />
            <label for="zero_price">0 Price Items</label>
        </div>
        <form action="#" method="get">
            <div class="update_button">
                <input type="submit" value="Update" name="mybtn">
            </div>
        </form>
    </div>
{% endblock settings %}

{% block content %}
    <div id='box'>
        {% for product in products %}
            <div class="color_block">
                <div class="block_content">
                    <div class="number"><h3>#{{forloop.counter}}</h3></div>
                    <div class="picture"><img src="{{ product.image_url }}"></div>
                    <h3>{{ product.name }}</h3>
                    <p>{{ product.price }} | {{ product.accuracy }}</p>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock content %}

{% block scripts %}
<script>
    const data = '{{qs_json}}'
    const allData = JSON.parse(data.replace(/&quot;/g, '"'))
    const itemAmount = document.getElementById('search_here')
    const listData = allData['data']
    let number

    let filteredArr = []

    itemAmount.addEventListener('keyup', (e)=>{
        number = 0
        box.innerHTML = ""
        filteredArr = listData.slice(0, parseInt(e.target.value))
        if (filteredArr.length > 0){
            filteredArr.map(info=>{
                number++;
                box.innerHTML += `<div class="color_block"><div class="block_content"><div class="number"><h3>#${number}</h3></div><div class="picture"><img src="${info['image_url']}"></div><h3>${info['name']}</h3><p>${info['price']} | ${info['accuracy']}</p></div></div>`
            })
        } else {
            box.innerHTML = `<div class="color_block"><div class="block_content"><h3>No results found...</h3></div></div>`
        }
    })
</script>
{% endblock scripts %}